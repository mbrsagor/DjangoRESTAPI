from django.contrib.auth import authenticatefrom django.contrib.auth.models import Userfrom django.core.exceptions import ObjectDoesNotExistfrom django.db import transactionfrom drf_role.enums import RoleEnumfrom rest_framework.authtoken.models import Tokenfrom rest_framework.viewsets import ModelViewSetfrom rest_framework.views import APIViewfrom rest_framework.response import Responsefrom core.models.profile import Profilefrom core.serializers.profile_serializer import *class ProfileViewSet(ModelViewSet):    queryset = Profile.objects.filter()    serializer_class = ProfileSerializerclass LoginAPIView(APIView):    def post(self, request, *args, **kwargs):        serializer = LoginSerializer(data=request.data)        if serializer.is_valid(raise_exception=True):            username = serializer.validated_data.get('username')            password = serializer.validated_data.get('password')            user = authenticate(username=username, password=password)            try:                profile = Profile.objects.get(user_id=user.pk)                token, _create = Token.objects.get_or_create(user_id=user.pk)                response = {                    'token': token.key,                    'user_role': profile.user.name,                    'user_id': profile.pk,                    'user_name': profile.name,                }                return Response(response)            except (Profile.DoesNotExist, AttributeError):                error_response = {                    'non_fields_error': ['Authentication credentials may be wrong. Please try again.']                }                return Response(error_response)